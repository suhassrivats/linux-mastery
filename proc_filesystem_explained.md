# The /proc Filesystem — A Detailed Guide

---

## Overview

`/proc` is a **virtual filesystem** (sometimes called a *pseudo-filesystem*) that provides a window into the Linux kernel and running processes. It does not reside on disk — the kernel generates its contents on-the-fly when you read it. It is the primary interface for inspecting system state, process information, and tuning kernel parameters.

---

## 1. What Makes /proc Special?

```text
/proc — VIRTUAL FILESYSTEM
┌─────────────────────────────────────────────────────────────────┐
│  • No disk storage — content generated by kernel when read      │
│  • Mounted at boot (typically at /proc)                          │
│  • Files appear to exist, but are interfaces to kernel data      │
│  • Read = query kernel state   Write = modify kernel parameters  │
└─────────────────────────────────────────────────────────────────┘

Normal file:  disk → inode → blocks → your read
/proc file:   your read → kernel handler → generated data → you
```

| Property | Normal Filesystem | /proc |
| -------- | ----------------- | ----- |
| Storage | Disk (or flash) | None — virtual |
| Content | Static/persistent | Generated on read |
| Size | Fixed | Often 0 (reported); content varies |
| Write | Stores data | Can change kernel parameters (where allowed) |

---

## 2. Top-Level Structure

```text
/proc/
├── [0-9]*/           ← Process directories (PID as name)
│   ├── cmdline       ← Command that started the process
│   ├── status        ← Human-readable process info
│   ├── stat          ← Process stats (for parsing)
│   ├── maps          ← Virtual memory map
│   ├── fd/           ← Open file descriptors
│   ├── cwd           ← Current working directory (symlink)
│   ├── exe           ← Executable (symlink)
│   ├── limits        ← Resource limits
│   └── ...
├── self              ← Symlink to current process's /proc/[pid]
├── thread-self       ← Symlink to current thread
├── cpuinfo           ← CPU information
├── meminfo           ← Memory statistics
├── loadavg           ← Load average
├── uptime            ← System uptime
├── version           ← Kernel version
├── sys/              ← Kernel tunables (sysctl)
├── net/              ← Network subsystem info
├── diskstats         ← Disk I/O stats
├── mounts            ← Mounted filesystems
└── ...
```

---

## 3. System-Wide Information

### 3.1 `/proc/meminfo` — Memory Statistics

Shows current memory usage. Key fields:

```text
MemTotal:       Total usable RAM
MemFree:        Completely unused RAM
MemAvailable:   Estimated memory available for starting apps (includes reclaimable)
Buffers:        Memory used by block device buffers
Cached:         Page cache (file data in RAM)
SwapTotal:      Total swap space
SwapFree:       Unused swap
```

**Example (abbreviated):**

```text
$ cat /proc/meminfo
MemTotal:        16384000 kB
MemFree:          2048000 kB
MemAvailable:     8192000 kB
Buffers:           256000 kB
Cached:           4096000 kB
SwapTotal:        2097148 kB
SwapFree:         2097148 kB
```

### 3.2 `/proc/cpuinfo` — CPU Information

One block per logical CPU. Important fields:

| Field | Meaning |
| ----- | ------- |
| `processor` | Logical CPU index |
| `model name` | CPU model string |
| `cpu MHz` | Current frequency |
| `cache size` | L3 cache size |
| `cpu cores` | Cores per physical CPU |
| `siblings` | Logical CPUs per physical CPU |

### 3.3 `/proc/loadavg` — System Load

```text
$ cat /proc/loadavg
1.25 1.18 1.09 4/1234 56789
```

| Position | Meaning |
| -------- | ------- |
| 1.25 | Load average (1 min) |
| 1.18 | Load average (5 min) |
| 1.09 | Load average (15 min) |
| 4 | Number of running processes |
| 1234 | Total number of processes |
| 56789 | Last PID allocated |

**Load average**: On a system with N CPUs, a load of N means CPUs are fully utilized on average. Higher than N suggests processes are waiting.

### 3.4 `/proc/uptime` — Uptime and Idle Time

```text
$ cat /proc/uptime
12345.67 24680.12
```

- First number: seconds since boot.
- Second number: sum of seconds all CPUs have been idle.

### 3.5 `/proc/version` — Kernel Version

```text
$ cat /proc/version
Linux version 6.1.0-... (gcc ...)
```

### 3.6 `/proc/diskstats` — Disk I/O

Per-disk and per-partition statistics (reads, writes, sectors, time). Used by tools like `iostat`.

---

## 4. Process-Specific: `/proc/[pid]`

Each running process has a directory `/proc/<PID>`. Here, `<PID>` is the process ID.

### 4.1 Key Files in `/proc/[pid]`

| File | Purpose |
| ---- | ------- |
| `cmdline` | Full command line (null-separated) |
| `comm` | Short command name (e.g. `cat`) |
| `status` | Human-readable status (VmRSS, state, etc.) |
| `stat` | Machine-parseable process stats |
| `maps` | Virtual memory layout (like `pmap`) |
| `smaps` | Detailed memory breakdown per mapping |
| `fd/` | Directory of open file descriptors |
| `cwd` | Symlink to current working directory |
| `exe` | Symlink to executable |
| `limits` | Resource limits (ulimit-style) |
| `io` | I/O statistics (reads, writes) |
| `environ` | Process environment (null-separated) |
| `task/[tid]/` | Per-thread info (one dir per thread) |

### 4.2 `/proc/[pid]/status` — Process Status

```text
Name:   cat
State:  R (running)
VmRSS:  1234 kB      ← Resident set size (physical RAM used)
VmSize: 5678 kB      ← Total virtual memory
Threads:        1
```

**State codes**: R (running), S (sleeping), D (uninterruptible sleep), Z (zombie), T (stopped).

### 4.3 `/proc/[pid]/maps` — Memory Map

Shows virtual memory regions (VMAs):

```text
00400000-00401000 r--p 00000000 08:01 12345  /usr/bin/cat
00401000-00402000 r-xp 00001000 08:01 12345  /usr/bin/cat
7fff0000-7fff2000 rw-p 00000000 00:00 0     [stack]
```

Format: `address range | permissions | offset | device | inode | pathname`

### 4.4 `/proc/[pid]/fd/` — Open File Descriptors

```text
$ ls -la /proc/1234/fd/
lrwx------ 1 user user 64 Jan 1 12:00 0 -> /dev/pts/0
lrwx------ 1 user user 64 Jan 1 12:00 1 -> /dev/pts/0
lrwx------ 1 user user 64 Jan 1 12:00 2 -> /dev/pts/0
lrwx------ 1 user user 64 Jan 1 12:00 3 -> /home/user/file.txt
```

Each number is a file descriptor; the symlink target shows what it refers to.

---

## 5. `/proc/sys` — Kernel Parameters

`/proc/sys` exposes kernel tunables. Many are documented under `sysctl` and can be changed at runtime (with appropriate privileges).

### 5.1 Structure

`/proc/sys` mirrors the `sysctl` hierarchy:

```text
/proc/sys/
├── kernel/      ← Hostname, domain, panic, etc.
├── vm/          ← Memory management (swappiness, dumpable, etc.)
├── net/         ← Network (ipv4, ipv6, core, etc.)
├── fs/          ← Filesystem limits (file-max, inode-nr, etc.)
└── user/        ← User namespace limits
```

### 5.2 Reading and Writing

```bash
# Read
cat /proc/sys/vm/swappiness

# Write (requires root)
echo 10 > /proc/sys/vm/swappiness

# Or use sysctl
sysctl vm.swappiness
sysctl -w vm.swappiness=10
```

**Note**: Dots in `sysctl` names become slashes in `/proc/sys`. Example: `vm.swappiness` → `/proc/sys/vm/swappiness`.

### 5.3 Common Parameters

| Parameter | Path | Typical use |
| --------- | ---- | ----------- |
| `swappiness` | `vm/swappiness` | 0–100; higher = more aggressive swap |
| `overcommit_memory` | `vm/overcommit_memory` | Overcommit policy |
| `file-max` | `fs/file-max` | Max open files system-wide |
| `net.ipv4.ip_forward` | `net/ipv4/ip_forward` | Enable IP forwarding |

---

## 6. Special Directories

| Path | Purpose |
| ---- | ------- |
| `/proc/self` | Symlink to `/proc/[pid]` of the process reading it (e.g. your shell) |
| `/proc/thread-self` | Symlink to current thread's directory |
| `/proc/net` | Network subsystem (sockets, interfaces, routing, etc.) |

---

## 7. Detailed Explanations

### 7.1 Why a Filesystem?

The filesystem interface provides:

- **Uniform access**: Use `cat`, `read()`, `open()` — standard tools and APIs.
- **Permissions**: Standard Unix permissions apply (root-only writes to `/proc/sys`, etc.).
- **Discoverability**: `ls`, `find` to explore what's available.
- **No custom APIs**: No need for special kernel interfaces in userspace.

### 7.2 How It Works Under the Hood

- Each "file" in `/proc` is represented by an **inode** and **dentry** in the VFS (Virtual File System) layer.
- When you `read()` a file, the VFS calls the **procfs handler** registered for that file.
- The handler reads kernel data structures (e.g. `task_struct`, `meminfo`) and **formats** them into text or binary.
- No data is stored; each read triggers a fresh query.

### 7.3 Security Considerations

- **Visibility**: `/proc/[pid]` exposes process details. Typically, you see only your own processes unless you're root.
- **Sensitive data**: `cmdline`, `environ` can contain passwords or secrets. Restrict access in multi-user systems.
- **Modification**: Writing to `/proc/sys` changes kernel behavior. Incorrect values can destabilize the system.

### 7.4 Relation to Other Interfaces

| Interface | Purpose |
| --------- | ------- |
| `/proc` | Process & kernel introspection, some tuning |
| `/sys` (sysfs) | Device and driver model, hardware topology |
| `sysctl` | Alternative way to read/write `/proc/sys` |

`/proc` is older and more process-centric; `/sys` is structured around kernel objects (devices, buses, etc.).

### 7.5 Common Use Cases

1. **Memory debugging**: `cat /proc/[pid]/smaps` for detailed per-mapping memory.
2. **Open files**: `ls /proc/[pid]/fd/` to see what a process has open.
3. **Load monitoring**: Parse `/proc/loadavg` for scripts.
4. **Tuning**: Set `vm.swappiness`, `net.core.somaxconn`, etc. via `/proc/sys`.
5. **Troubleshooting**: Inspect `cmdline`, `maps`, `limits` when diagnosing process behavior.

---

## Summary

| Path / Concept | Purpose |
| -------------- | ------- |
| `/proc` | Virtual filesystem for kernel and process info |
| `/proc/meminfo` | Memory usage statistics |
| `/proc/cpuinfo` | CPU model and topology |
| `/proc/loadavg` | System load average |
| `/proc/[pid]` | Process-specific information |
| `/proc/[pid]/maps` | Virtual memory layout |
| `/proc/[pid]/fd/` | Open file descriptors |
| `/proc/sys` | Kernel tunables (sysctl) |
| `/proc/self` | Current process's /proc directory |
